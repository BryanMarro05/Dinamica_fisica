<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>¬°Atina la Velocidad! ‚Äî Juego de F√≠sica</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* === ESTILOS GLOBALES === */
    :root{
      --bg:#0a0e17; 
      --card:#0d1423; 
      --accent:#ff2d75; 
      --accent2:#00f0ff; 
      --muted:#a0aec0; 
      --glass: rgba(13, 20, 35, 0.6);
      --success:#38b04a;
      --warning:#f6ad55;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #070a15 0%, #12182d 100%);
      color: #e2e8f0;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    #starfield {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    .wrap{ max-width:1100px; margin:20px auto; padding:0 16px; position: relative; z-index: 2;}
    header{ display:flex; align-items:center; gap:16px; margin-bottom:16px; animation: fadeIn 0.8s ease-out;}
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .logo{
      width:56px;height:56px;border-radius:14px;
      background: linear-gradient(135deg, #ff2d75, #ff6b6b, #00f0ff);
      display:grid;place-items:center;
      font-weight:800;font-family:'Orbitron', monospace;
      font-size:20px;color:#0a0e17;
      box-shadow: 0 0 20px rgba(255,45,117,0.6);
    }
    h1{
      font-family:'Orbitron', monospace;
      font-size:24px;font-weight:700;
      background:linear-gradient(to right,#ff2d75,#00f0ff);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      letter-spacing:1px;
    }
    .subtitle{font-size:14px;color:var(--muted);margin-top:4px;}
    .layout{display:grid;grid-template-columns:440px 1fr;gap:20px;}
    @media(max-width:900px){.layout{grid-template-columns:1fr;}}
    .card{
      background:var(--glass);backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:16px;padding:20px;
      box-shadow:0 10px 30px rgba(0,0,0,0.4);
    }
    .controls{display:flex;flex-direction:column;gap:14px;}
    label{display:flex;justify-content:space-between;font-size:14px;color:var(--muted);font-weight:500;}
    input[type=range]{
      width:100%;height:6px;background:#1a2235;border-radius:3px;outline:none;-webkit-appearance:none;
    }
    input[type=range]::-webkit-slider-thumb{
      -webkit-appearance:none;width:18px;height:18px;border-radius:50%;
      background:var(--accent2);cursor:pointer;box-shadow:0 0 8px var(--accent2);
    }
    .btn-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;}
    .btn{
      flex:1;min-width:90px;padding:10px;border:none;border-radius:10px;
      font-weight:700;font-size:14px;cursor:pointer;transition:all 0.2s ease;
      font-family:'Inter',sans-serif;color:#0a0e17;
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.3);}
    .btn:active{transform:translateY(0);}
    .btn-play{background:linear-gradient(to right,#ff2d75,#ff6b6b);}
    .btn-step{background:#4fd1c5;}
    .btn-reset{background:#a0aec0;}
    .btn-challenge{background:linear-gradient(to right,#00f0ff,#00b8ff);color:#0a0e17;}
    .btn-hint{background:#805ad5;color:white;}
    canvas{
      background:#090f1a;border-radius:16px;width:100%;height:320px;display:block;
      box-shadow:inset 0 0 20px rgba(0,0,0,0.7);
    }
    .stats{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px;}
    .stat{background:rgba(0,0,0,0.2);padding:8px 12px;border-radius:10px;font-size:13px;font-weight:600;}
    #feedback{
      text-align:center;padding:14px;border-radius:12px;font-weight:700;font-size:16px;
      margin-top:16px;background:rgba(0,0,0,0.2);transition:all 0.3s ease;
    }
    .scoreboard{display:flex;justify-content:space-between;margin-top:12px;font-weight:700;color:var(--accent2);font-size:15px;}
    .leaderboard,.hint-box{margin-top:20px;background:rgba(0,0,0,0.2);padding:14px;border-radius:12px;}
    .leaderboard h4,.hint-box h4{margin-bottom:10px;color:var(--accent2);font-size:15px;}
    .leaderboard ol{padding-left:20px;font-size:13px;}
    .leaderboard li{margin-bottom:4px;}
    .hint-content{display:none;margin-top:10px;padding:10px;background:rgba(0,240,255,0.1);
      border-radius:8px;font-family:monospace;font-size:14px;white-space:pre-line;color:#e0f7ff;}
  </style>
</head>
<body>
  <!-- Fondo de estrellas -->
  <canvas id="starfield"></canvas>

  <div class="wrap">
    <header>
      <div class="logo">‚ö°</div>
      <div>
        <h1>¬°ATINA LA VELOCIDAD!</h1>
        <div class="subtitle">Haz que m‚ÇÇ quede detenido tras la colisi√≥n el√°stica</div>
      </div>
    </header>

    <div class="layout">
      <div class="card">
        <div class="scoreboard">
          <div>Puntuaci√≥n: <span id="score">0</span></div>
          <div>Nivel: <span id="level">1</span></div>
        </div>

        <h3 style="margin:16px 0 12px; font-weight:700; color:#00f0ff;">Controles</h3>

        <!-- NUEVO: entrada de nombre -->
        <div style="margin-bottom:10px;">
          <label>Nombre del jugador</label>
          <input id="player-name" type="text" placeholder="Ingresa tu nombre" style="width:100%;padding:8px;border-radius:8px;border:none;margin-top:4px;">
        </div>

        <div class="controls">
          <div><label>masa 1 (kg) <span id="m1val">2.00</span></label><input id="m1" type="range" min="0.5" max="6" step="0.1" value="2" disabled></div>
          <div><label>masa 2 (kg) <span id="m2val">1.00</span></label><input id="m2" type="range" min="0.5" max="6" step="0.1" value="1" disabled></div>
          <div><label>velocidad inicial 1 (px/frame) <span id="v1val">0.00</span></label><input id="v1" type="range" min="-6" max="6" step="0.1" value="0"></div>
          <div><label>velocidad inicial 2 (px/frame) <span id="v2val">-1.00</span></label><input id="v2" type="range" min="-6" max="6" step="0.1" value="-1" disabled></div>

          <div class="btn-row">
            <button id="play" class="btn btn-play">‚ñ∂ Jugar</button>
            <button id="step" class="btn btn-step">‚è≠ Paso</button>
            <button id="reset" class="btn btn-reset">‚ü≤ Reiniciar</button>
            <button id="new-challenge" class="btn btn-challenge">üé≤ Nuevo reto</button>
          </div>

          <button id="show-hint" class="btn btn-hint">‚ùì Mostrar f√≥rmula</button>
          <div class="hint-box">
            <h4>Consejo de F√≠sica</h4>
            <div class="hint-content" id="hint-content">
              Para que v‚ÇÇ final = 0 tras una colisi√≥n el√°stica:
              
              v‚ÇÅ = ((m‚ÇÅ - m‚ÇÇ) / (2¬∑m‚ÇÅ)) ¬∑ v‚ÇÇ
              
              ¬°Ajusta v‚ÇÅ usando esta f√≥rmula!
            </div>
          </div>

          <div id="feedback">üéØ Ajusta v‚ÇÅ y haz clic en "Jugar"</div>

          <div class="leaderboard">
            <h4>üèÜ Mejores Puntajes</h4>
            <ol id="leaderboard-list"></ol>
          </div>
        </div>

        <div style="margin-top:16px;">
          <h4 style="margin-bottom:10px; font-weight:600;">Indicadores</h4>
          <div class="stats">
            <div class="stat">p = <span id="momentum">‚Äì</span></div>
            <div class="stat">E = <span id="energy">‚Äì</span></div>
            <div class="stat">v‚ÇÅ = <span id="v1s">‚Äì</span></div>
            <div class="stat">v‚ÇÇ = <span id="v2s">‚Äì</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <canvas id="scene" width="800" height="320"></canvas>
        <div style="display:flex;justify-content:space-between;margin-top:12px;color:var(--muted);font-size:13px;">
          <span>Tiempo: <span id="tframe">0</span></span>
          <span>Impactos: <span id="hits">0</span></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* === ESTRELLAS === */
    const starCanvas = document.getElementById('starfield');
    const starCtx = starCanvas.getContext('2d');
    function resizeStars(){ starCanvas.width = window.innerWidth; starCanvas.height = window.innerHeight; }
    resizeStars();
    const stars = Array.from({length:150},()=>({x:Math.random()*starCanvas.width,y:Math.random()*starCanvas.height,size:Math.random()*1.5,opacity:Math.random()*0.8+0.2,twinkleSpeed:Math.random()*0.02+0.005}));
    function animateStars(){
      starCtx.clearRect(0,0,starCanvas.width,starCanvas.height);
      for(const s of stars){
        s.opacity += Math.sin(Date.now()*s.twinkleSpeed)*0.01;
        s.opacity = Math.max(0.2,Math.min(1,s.opacity));
        starCtx.fillStyle=`rgba(255,255,255,${s.opacity})`;
        starCtx.beginPath();starCtx.arc(s.x,s.y,s.size,0,Math.PI*2);starCtx.fill();
      }
      requestAnimationFrame(animateStars);
    }
    animateStars(); window.addEventListener('resize',resizeStars);

    /* === AUDIO === */
    const ctxAudio = new (window.AudioContext||window.webkitAudioContext)();
    function playSound(f=440,d=0.1,type='sine',vol=0.1){
      const o=ctxAudio.createOscillator(),g=ctxAudio.createGain();
      o.connect(g);g.connect(ctxAudio.destination);
      o.type=type;o.frequency.value=f;g.gain.value=vol;
      o.start();g.gain.exponentialRampToValueAtTime(0.001,ctxAudio.currentTime+d);
      o.stop(ctxAudio.currentTime+d);
    }

    /* === DOM === */
    const canvas=document.getElementById('scene'),ctx=canvas.getContext('2d');
    const m1s=document.getElementById('m1'),m2s=document.getElementById('m2'),v1s=document.getElementById('v1'),v2s=document.getElementById('v2');
    const m1val=document.getElementById('m1val'),m2val=document.getElementById('m2val'),v1val=document.getElementById('v1val'),v2val=document.getElementById('v2val');
    const playBtn=document.getElementById('play'),stepBtn=document.getElementById('step'),resetBtn=document.getElementById('reset'),newChallengeBtn=document.getElementById('new-challenge');
    const feedbackEl=document.getElementById('feedback'),showHintBtn=document.getElementById('show-hint'),hintContent=document.getElementById('hint-content');
    const momentumEl=document.getElementById('momentum'),energyEl=document.getElementById('energy'),v1sEl=document.getElementById('v1s'),v2sEl=document.getElementById('v2s');
    const tframeEl=document.getElementById('tframe'),hitsEl=document.getElementById('hits'),scoreEl=document.getElementById('score'),levelEl=document.getElementById('level');
    const leaderboardList=document.getElementById('leaderboard-list');
    const nameInput=document.getElementById('player-name');

    /* === ESTADO === */
    let m1=2,m2=1,v1=0,v2=-1,r1=22,r2=22;
    let x1=150,x2=canvas.width-150;
    let playing=false,frame=0,hits=0,gameActive=true;
    let score=0,level=1;
    let particles=[],failedAttempts=0;
    let playerName = localStorage.getItem('playerName') || "";

    if(playerName){ nameInput.value = playerName; }

    /* === PUNTAJES === */
    function saveScore(){
      if(!playerName) playerName = prompt("Ingresa tu nombre para guardar tu puntaje:") || "Jugador";
      localStorage.setItem('playerName', playerName);
      const scores = JSON.parse(localStorage.getItem('elasticCollisionScores') || '[]');
      scores.push({name: playerName, score: Math.floor(score), date: new Date().toLocaleDateString()});
      scores.sort((a,b)=>b.score-a.score);
      localStorage.setItem('elasticCollisionScores', JSON.stringify(scores.slice(0,5)));
      updateLeaderboard();
    }
    function updateLeaderboard(){
      const scores=JSON.parse(localStorage.getItem('elasticCollisionScores')||'[]');
      leaderboardList.innerHTML = scores.length? scores.map(s=>`<li>${s.name}: ${s.score}</li>`).join('') : '<li>A√∫n no hay puntajes</li>';
    }

    /* === FUNCIONES === */
    function updateLabels(){m1val.textContent=+m1s.value;m2val.textContent=+m2s.value;v1val.textContent=+v1s.value;v2val.textContent=+v2s.value;}
    function setState(){m1=+m1s.value;m2=+m2s.value;v1=+v1s.value;v2=+v2s.value;}
    function resetSimulation(){
      setState();x1=150;x2=canvas.width-150;frame=0;hits=0;
      tframeEl.textContent=0;hitsEl.textContent=0;
      playing=false;gameActive=true;
      playBtn.textContent='‚ñ∂ Jugar';playBtn.className='btn btn-play';
      drawScene();
    }

    function drawBall(x,r,color,label,mass,vel){
      const grad=ctx.createRadialGradient(x-8,160-r/2,2,x,160,r);
      grad.addColorStop(0,color);grad.addColorStop(1,'#0a0e17');
      ctx.beginPath();ctx.arc(x,160,r,0,Math.PI*2);ctx.fillStyle=grad;ctx.fill();
      ctx.fillStyle='#fff';ctx.font='bold 13px Inter';ctx.textAlign='center';
      ctx.fillText(label,x,160-r-10);
      ctx.font='600 12px Inter';
      ctx.fillText(`${mass} kg`,x,160-r-
      ctx.fillText(`${mass} kg`, x, 160 - r + 28);
      ctx.fillText(`${vel.toFixed(2)} px/f`, x, 160 - r + 44);
    }

    function drawScene(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='rgba(255,255,255,0.05)';
      ctx.fillRect(0,158,canvas.width,4);

      for(const p of particles){
        ctx.fillStyle=`rgba(${p.color},${p.alpha})`;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
        ctx.fill();
      }

      drawBall(x1,r1,'#ff2d75','m‚ÇÅ',m1,v1);
      drawBall(x2,r2,'#00f0ff','m‚ÇÇ',m2,v2);
    }

    function spawnParticles(x,color){
      for(let i=0;i<15;i++){
        particles.push({
          x, y:160, vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*4,
          size:Math.random()*3+1, color, alpha:1
        });
      }
    }

    function updateParticles(){
      particles = particles.filter(p=>{
        p.x += p.vx; p.y += p.vy; p.alpha -= 0.02;
        return p.alpha>0;
      });
    }

    function collision(){
      // F√≥rmulas de colisi√≥n el√°stica 1D
      const u1=v1,u2=v2;
      const v1f=((m1 - m2)/(m1 + m2))*u1 + (2*m2/(m1 + m2))*u2;
      const v2f=(2*m1/(m1 + m2))*u1 + ((m2 - m1)/(m1 + m2))*u2;
      v1=v1f;v2=v2f;
      hits++;
      hitsEl.textContent=hits;
      playSound(440,0.1,'sine',0.15);
      spawnParticles((x1+x2)/2,'255,255,255');
    }

    function physicsStep(){
      if(!playing) return;
      x1 += v1; x2 += v2;
      frame++;
      tframeEl.textContent=frame;
      updateParticles();

      // Rebotes contra los bordes
      if(x1 - r1 < 0){x1 = r1; v1 *= -1; playSound(330,0.1,'square',0.08);}
      if(x2 + r2 > canvas.width){x2 = canvas.width - r2; v2 *= -1; playSound(330,0.1,'square',0.08);}

      // Colisi√≥n
      if(Math.abs(x2 - x1) < r1 + r2){
        const overlap = (r1 + r2) - Math.abs(x2 - x1);
        x1 -= overlap/2; x2 += overlap/2;
        collision();
      }

      // Mostrar datos
      const p = (m1*v1 + m2*v2).toFixed(2);
      const e = (0.5*m1*v1*v1 + 0.5*m2*v2*v2).toFixed(2);
      momentumEl.textContent = p;
      energyEl.textContent = e;
      v1sEl.textContent = v1.toFixed(2);
      v2sEl.textContent = v2.toFixed(2);

      drawScene();

      if(frame > 800){
        checkResult();
      } else if(playing){
        requestAnimationFrame(physicsStep);
      }
    }

    function checkResult(){
      playing = false;
      if(Math.abs(v2) < 0.05 && Math.abs(v1) > 0.1){
        feedbackEl.textContent = `üèÖ ¬°Perfecto, ${playerName || "Jugador"}! Lograste detener m‚ÇÇ üéâ`;
        feedbackEl.style.background = 'rgba(56,176,74,0.3)';
        playSound(660,0.2,'triangle',0.2);
        score += 100 * level;
        scoreEl.textContent = Math.floor(score);
        level++;
        levelEl.textContent = level;
        saveScore();
      } else {
        feedbackEl.textContent = `‚ùå m‚ÇÇ a√∫n se mueve (${v2.toFixed(2)}) ‚Äî intenta otra vez`;
        feedbackEl.style.background = 'rgba(246,173,85,0.25)';
        failedAttempts++;
        if(failedAttempts % 3 === 0) {
          feedbackEl.textContent += " üí° Usa el bot√≥n 'Mostrar f√≥rmula'";
        }
        playSound(220,0.2,'sawtooth',0.1);
      }
      playBtn.textContent='‚ñ∂ Reintentar';
      playBtn.className='btn btn-play';
      gameActive = true;
    }

    /* === EVENTOS === */
    [m1s,m2s,v1s,v2s].forEach(el=>el.addEventListener('input',()=>{
      updateLabels();setState();
    }));

    playBtn.addEventListener('click',()=>{
      if(!nameInput.value.trim()){
        alert("Por favor, ingresa tu nombre antes de jugar.");
        return;
      }
      playerName = nameInput.value.trim();
      localStorage.setItem('playerName', playerName);
      if(!playing){
        setState();
        feedbackEl.textContent = '‚è≥ Simulando...';
        feedbackEl.style.background = 'rgba(0,0,0,0.2)';
        playing = true;
        gameActive = false;
        playBtn.textContent='‚è∏ Pausa';
        playBtn.className='btn btn-reset';
        frame = 0; hits = 0;
        physicsStep();
      } else {
        playing = false;
        feedbackEl.textContent = '‚è∏ Pausado';
        playBtn.textContent='‚ñ∂ Reanudar';
        playBtn.className='btn btn-play';
      }
    });

    stepBtn.addEventListener('click',()=>{
      if(gameActive) physicsStep();
    });

    resetBtn.addEventListener('click',()=>{
      resetSimulation();
      feedbackEl.textContent='üéØ Ajusta v‚ÇÅ y haz clic en "Jugar"';
      feedbackEl.style.background='rgba(0,0,0,0.2)';
    });

    newChallengeBtn.addEventListener('click',()=>{
      m1s.value = (Math.random()*5+1).toFixed(1);
      m2s.value = (Math.random()*5+1).toFixed(1);
      v2s.value = (-Math.random()*3-0.5).toFixed(1);
      updateLabels(); setState();
      resetSimulation();
      feedbackEl.textContent='üéØ Nuevo reto: ajusta v‚ÇÅ para detener m‚ÇÇ';
      feedbackEl.style.background='rgba(0,0,0,0.2)';
    });

    showHintBtn.addEventListener('click',()=>{
      hintContent.style.display = hintContent.style.display==='block' ? 'none' : 'block';
    });

    /* === INICIALIZACI√ìN === */
    updateLabels();
    updateLeaderboard();
    resetSimulation();
  </script>
</body>
</html>
